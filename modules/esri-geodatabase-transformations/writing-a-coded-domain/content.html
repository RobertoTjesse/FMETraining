<h2 id="learning-objectives">
  <span>Learning Objectives</span>
</h2>
<p>After completing this unit, you’ll be able to:</p>
<ul>
  <li>Read domains from a Geodatabase.</li>
  <li>Write to an existing table using an existing domain.</li>
  <li>Know the limitations in regard to domain writing.</li>
</ul>
<h2 id="resources">
  <span>Resources</span>
</h2>
<ul>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingACodedDomain.zip" rel="noreferrer noopener" target="_blank">WritingACodedDomain.zip</a></li>
</ul>
<h2 id="introduction">
  <span>Introduction</span>
</h2>
<p>A domain is a set of rules that define permitted values for an attribute. They are used to constrain data values in order to ensure data integrity. A domain is defined in a geodatabase as a unique entity and can be applied to any attribute in any feature class within the geodatabase that contains the domain definition.<br />There are two types of geodatabase domains (coded domains and range domains) and both are supported by FME. A coded domain is essentially a list of multiple valid values while a range domain is a single permitted range of numeric values.</p>
<h2 id="domain-reading">
  <span>Domain Reading</span>
</h2>
<p>When reading a geodatabase, FME has an option to resolve domains.<img src="images/1638386796719.png" class="image image-block" alt="check Resolve Domains" /><br />When this option is checked an additional attribute will be added called _&lt;attribute&gt;_resolved_ which contains the textual description of the coded attribute value.<br /> </p>
<h2 id="domain-writing">
  <span>Domain Writing</span>
</h2>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://res.cloudinary.com/hy4kyit2a/image/upload/doc/trailhead/en-usb473bb5ea1b7e61dfb07e6a7e547de6b.gif" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p><strong>If you can, we would recommend using a geodatabase template as described in How to Use an Esri Template.</strong> This is generally easier and more flexible than defining domains within FME feature types.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<p><br />FME has the capability to write to existing or create new geodatabase tables. As such, when writing geodatabase domains, the workflow requirements will tend to fall under one of two scenarios:</p>
<ul>
  <li>Write to an existing table using an existing domain.</li>
  <li>Write to a new table using an existing domain.</li>
</ul>
<p>These scenarios will be controlled primarily by the following writer parameters:</p>
<ul>
  <li>Data Type: coded_domain / range_domain</li>
  <li>Validate Features to Write parameter value: Yes / No</li>
</ul>
<p>Despite the scenarios mentioned below, it should be noted that using an XML Workspace Document (containing the required domain definitions) or a file geodatabase as a template on a geodatabase writer, is the most efficient and highly recommended means of writing geodatabase domains. For more information on importing an XML document or a geodatabase Template with a schema, please see the Geodatabase Writer documentation. </p>
<h2 id="scenario-1-writing-to-an-existing-table-using-an-existing-domain">
  <span>Scenario 1: Writing to an existing table using an existing domain</span>
</h2>
<p>Any data written to an existing domain field is, by default, inserted as normal. As the table already exists, its attribute(s) will already be associated with the required domain and there is no need to set any parameter to define this connection.<br />However, if you wish to validate incoming data – for instance, compare it to a domain definition to ensure it has valid attribute values – then you must set the writer parameter “<em>Validate Features to Write”</em> to <strong>Yes</strong>. If the validation parameter is set to <strong>No</strong>, the data would pass into the Geodatabase without error, despite the fact that some data values may not meet domain rules.</p>
<h2 id="scenario-2-writing-to-a-new-table-using-an-existing-domain">
  <span>Scenario 2: Writing to a new table using an existing domain</span>
</h2>
<p>When creating a new table that is to use an existing domain, the attribute that needs to be associated with a domain should be given the data type <strong>coded_domain</strong> or <strong>range_domain</strong> (depending on its type) in the schema definition. One would then click the <strong>Edit</strong> button in the attribute width field and enter the name of the existing domain in the "<em>Domain Name</em>" section.<img src="images/1638387032495.png" class="image image-block" alt="Coded Domain" /> </p>
<h2 id="limitations">
  <span>Limitations</span>
</h2>
<p>There are a few limitations in regard to domain writing.<br />Firstly, it is not possible to write to an existing table and to either create an association with an existing domain or create an entirely new domain. That is because this association is wrapped up in the table definition, and an existing table definition cannot be changed by FME. You would need to drop the existing table and re-create it entirely in order to be able to do this.<br />Secondly, for the same reason stated above, creating a domain is a one-off translation. You would set the data type to coded_domain/range_domain for the initial process, but subsequent loads of the data should be done with the data type changed back the actual type of data (char, integer, etc.)<br />Finally, it is not possible to create a domain dynamically (i.e. the domain definition should be manually defined prior to execution and not defined during the workspace process).<br />The following example demonstrates Scenario 2: Writing to a new table and using an existing domain through the use of a template. </p>
<h2 id="requirements">
  <span>Requirements</span>
</h2>
<p>The Esri Geodatabase (File Geodb) reader/writer used in the following example requires that a licensed version of ArcGIS be available to the user. For more information on required ArcGIS license levels, please see <a href="https://community.safe.com/s/article/required-arcgis-license-types-for-fme-geodatabase" rel="noreferrer noopener" target="_blank">Required ArcGIS License Types for FME Geodatabase Formats</a>.</p>
<h2 id="video">
  <span>Video</span>
</h2>
<p><iframe width="640" src="https://play.vidyard.com/SJminXAbhLaAJMeo7ftSqn.html?" height="360" title="Video Content"></iframe><br title="Video Content" /> </p>
<h2 id="source-data">
  <span>Source Data</span>
</h2>
<p><a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingACodedDomain/roads.zip" rel="noreferrer noopener" target="_blank">Roads (Autodesk AutoCAD DWG/DXF)</a></p>
<p><img src="images/1638387092412.png" class="image image-block" alt="view Roads in Visual Preview" /><br /><br />In the above image, we see a visualization of the source <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingACodedDomain/roads.zip" rel="noreferrer noopener" target="_blank">Roads AutoCAD DWG</a>. The values that will be subject to the destination geodatabase domain definition can be seen in the <em>autocad_layer</em> format attribute.<br /> </p>
<h2 id="step-by-step-instructions">
  <span>Step-by-step Instructions</span>
</h2>
<p><strong>1. Read Source Data</strong><br />In a blank workspace, add an <strong>Autodesk AutoCAD DWG/DXF</strong> writer to the canvas, browse to the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingACodedDomain/roads.zip" rel="noreferrer noopener" target="_blank">Roads.zip</a> dataset that is provided in the Files section of this tutorial, you can leave the file zipped. Change the <em>Workflow Options</em> to <strong>Single Merged Feature Type</strong>. Then open the parameters.</p>
<p><img src="images/1638387463316.png" class="image image-block" alt="Add Reader" /><br /><br />In the parameters, set the <em>Group Entities</em> <em>By</em> to <strong>Attribute Schema</strong>, then click <strong>OK</strong> twice to add the reader.<br /><img src="images/1638388231769.png" class="image image-block" alt="Select Attribute Schema" /><br /><br />Once the reader has been added to the workspace canvas, double-click on the reader feature type to open the parameters. Switch to the <em>Format Attributes</em> tab and enable the <strong>autocad_layer</strong>, then click <strong>OK</strong>.<br /><img src="images/1638388928416.png" class="image image-block" alt="expose autocad_layer" /><br /><br /><strong>2. Map Attributes </strong><br />There are two different ways to map attributes to domains, either by domain code or by resolved domain values. If following along with the demo, only use one method.</p>
<h2 id="option-1-map-attributes-to-domain-codes">
  <span>Option 1: Map Attributes to Domain Codes</span>
</h2>
<p>Next, we will use an AttributevalueMapper to map the incoming values from the source DWG to the domain codes which we will apply to the domain definition.<br />Add an AttributeValueMapper to the canvas and connect it to the &lt;ALL&gt; reader feature type. In the parameters, set the <em>Source Attribute</em> to <strong>autocad_layer</strong> and enter <strong>StreetCategory</strong> as the <em>Destination Attribute</em>. Enter <strong>99</strong> as the <em>Default Value</em> as this will be the domain code we will use for Unknown street types.<br />In the Value Mapping part of the parameters dialog, enter the values as seen in the table.</p>
<table class="featureTable sort_table">
  <thead class="thead sorted">
    <tr>
      <th colspan="1" rowspan="1" scope="col">Source Value</th>
      <th colspan="1" rowspan="1" scope="col">Destination Value</th>
    </tr>
  </thead>
  <tbody class="tbody">
    <tr>
      <td colspan="1" rowspan="1">Arterial</td>
      <td colspan="1" rowspan="1">1</td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">Secondary</td>
      <td colspan="1" rowspan="1">2</td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">Residential </td>
      <td colspan="1" rowspan="1">3</td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">Private</td>
      <td colspan="1" rowspan="1">4</td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">NonCity</td>
      <td colspan="1" rowspan="1">5</td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">Other</td>
      <td colspan="1" rowspan="1">6</td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">Collector</td>
      <td colspan="1" rowspan="1">7</td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">Unknown</td>
      <td colspan="1" rowspan="1">99</td>
    </tr>
  </tbody>
</table>
<p><img src="images/1638388987207.png" class="image image-block" alt="AttributeValueMapper parameters" /></p>
<p> </p>
<h2 id="option-2-nbsp-map-attributes-to-resolved-domain-values">
  <span>Option 2:  Map Attributes to Resolved Domain Values</span>
</h2>
<p>As an alternative to the step described above, one could instead use an AttributeManager, to take the value from the source DWG file and map it to the domain definition based on the domain definitions resolved value. To do so, add an AttributeManager to the workspace and open the parameters dialog. Rename <em>autocad_layer</em> to <strong>StreetCategory_resolved</strong> - the resolved version of the domain.</p>
<p><img src="images/1638389057005.png" class="image image-block" alt="create StreetCategory_resolved" /><br /><br />The above tends to be most applicable when your workflow falls under Scenario #1 (writing to an existing table using an existing domain definition) or Scenario #2 (writing to a new table in the geodatabase using an existing domain). In both scenarios, it would be assumed that one does not know the actual domain codes contained in the domain definition and instead know the resolved value.<br /><br /><strong>3. Write Features and Create Domain</strong><br />Add an Esri Geodatabase (File Geodb) writer to the canvas, browse to a location to save the geodatabase. Leave the Feature Class or Table Definition set to Copy from Reader then open the parameters.<br />In the parameters, enable <strong>Overwrite Existing Geodatabase</strong>, then browse to the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingACodedDomain/RoadsTemplate.gdb.zip" rel="noreferrer noopener" target="_blank">RoadsTemplate.gdb</a> for the Template File Geodatabase. Next, expand the Advanced section and set <em>Validate Features to Write</em> to <strong>Yes</strong>. This setting will ensure that the incoming source data adheres to our domain definition. Then click <strong>OK</strong> twice to add the writer.<br /><br /><img src="images/1638390056807.png" class="image image-block" alt="Esri Geodatabase writer parameters" /><br /><br />Connect the writer to either the AttributeValueMapper or the AttributeManager, then open the writer feature type parameters.<br />In the feature type parameters, change the Feature Class or Table Name to something more meaningful such as <strong>Streets</strong>.<br />Next, switch to the Attributes tab and rename <em>autocad_layer</em> to <strong>StreetCategory</strong> and click <strong>OK</strong>.<br /><img src="images/1638390136488.png" class="image image-block" alt="rename autocad_layer to StreetCategory" /><br /><br /><strong>4. Save and Run the Workspace</strong><br />Save the workspace and then run it. View your output in ArcMap.<br /><img src="images/1638390229162.png" class="image image-block" alt="View your output in ArcMap" /><br /><img src="images/1638390280908.png" class="image image-block" alt="Inspect domain properties" /></p>