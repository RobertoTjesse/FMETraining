<h2 id="learning-objectives">
  <span>Learning Objectives</span>
</h2>
<p>After completing this unit, you’ll be able to:</p>
<ul>
  <li>Know the different types of relationship classes.</li>
  <li>Write relationship classes.</li>
  <li>Delete records from a relationship class.</li>
</ul>
<h2 id="introduction">
  <span>Introduction</span>
</h2>
<p>Geodatabase relationship classes are used to manage the relationships between features in one feature class with features in another. Attributed and non-attributed relationship classes can be read and written with FME. Relationships are not rows in a table or feature class like other features, but linkages through the primary and foreign key values of an origin and destination feature.</p>
<p>“Origin” features belong to the “Origin Table/Feature Class” specified when creating the relationship class in ArcCatalog, while “destination” features belong to the “Destination Table/Feature Class”.</p>
<p>Relationship classes can be simple or composite, as well as attributed or non-attributed.</p>
<p>For more information regarding relationships in ArcGIS, please refer to: <a href="https://desktop.arcgis.com/en/arcmap/10.7/manage-data/relationships/relationships-and-arcgis.htm" rel="noreferrer noopener" target="_blank">https://desktop.arcgis.com/en/arcmap/10.7/manage-data/relationships/relationships-and-arcgis.htm</a></p>
<p><em>Note that the Esri File Geodatabase reader/writer used/mentioned in this article requires a licensed version of ArcGIS.. For more information on required ArcGIS license levels, please see </em><a href="https://community.safe.com/s/article/required-arcgis-license-types-for-fme-geodatabase" rel="noreferrer noopener" target="_blank">Required ArcGIS License Types for FME Geodatabase Formats.</a> <em>The </em><em><a href="https://community.safe.com/s/article/comparison-of-fme-readers-and-writers-for-sde-and" rel="noreferrer noopener" target="_blank">Comparison of FME readers and writers for SDE and Geodatabase</a></em><em> may also be useful.</em></p>
<h2 id="video">
  <span>Video</span>
</h2>
<p><iframe width="640" src="https://play.vidyard.com/axV2djmzx2urHBJf27fLV5.html?" height="360" title="Video Content"></iframe><br title="Video Content" /> </p>
<h2 id="relationship-classes">
  <span>Relationship Classes</span>
</h2>
<p><strong>Simple vs. Composite:</strong></p>
<p>In a “Simple” Relationship class, features can exist independently of each other – for example, a feature can exist without necessarily having an attachment, and any attachment can be deleted without affecting the feature.</p>
<p>In a “Composite” Relationship class, origin and destination objects are more closely connected. If a feature were deleted so too would be the related attachment record.<br /> </p>
<p><strong>Attributed vs. Non-attributed:</strong></p>
<p>In a non-attributed relationship, the relationship class is contained in a non-spatial table that only contains the origin and destination feature keys.</p>
<p><img src="images/1638754527891.png" class="image image-block" alt="non-attributed relationship" /></p>
<p>In an attributed relationship, the relationship class is contained in a non-spatial table with more attributes than just the identifying keys.</p>
<p><img src="images/1638754551354.png" class="image image-block" alt="attributed relationship" /></p>
<p> </p>
<h2 id="reading-relationship-classes">
  <span>Reading Relationship Classes</span>
</h2>
<p>When reading a relationship class, both the origin and destination feature classes must be read at the same time as the relationship class. A relationship feature type shows an allowed geometry of either <em>geodb_relationship </em>or <em>geodb_attributed_relationship.</em></p>
<p><img src="images/1638754584732.png" class="image image-block" alt="relationship feature type shows an allowed geometry of either geodb_relationship or geodb_attributed_relationship" /></p>
<p>Each relationship feature has the following Format Attributes stored on it when read from a relationship class:</p>
<ul>
  <li><em>geodb_rel_origin_oid</em> - the primary key of the related origin feature which was used when the relationship was set up using ArcGIS.</li>
  <li><em>geodb_rel_destination_oid - </em>the primary key of the related destination feature which was used when the relationship was set up using ArcGIS.</li>
</ul>
<p>These attributes can be used to identify relationships between the origin and destination features within the workspace. These attributes are used for FME’s processes, as format attributes, and do not appear in the final written output.<br /> </p>
<h2 id="performance">
  <span>Performance</span>
</h2>
<p>Note that reading from relationship classes is very slow since each relationship is validated when read. Because this functionality is not often required, FME includes a parameter that, by default, turns off relationship reading to improve performance. Therefore, to read relationship classes you must first locate and deactivate the "Ignore Relationship Info" parameter.</p>
<p><img src="images/1638754634860.png" class="image image-block" alt="deactivate the &quot;Ignore Relationship Info&quot; parameter" /><br /> </p>
<h2 id="writing-relationship-classes">
  <span>Writing Relationship Classes</span>
</h2>
<p>Relationship classes cannot be created through FME and must be set up through ArcGIS prior to running the translation. Once the relationship has been defined in ArcGIS, the following attributes must be stored on features written to a relationship class table in FME (<strong>this only relates to M:N and attributed relationships because you interact with the relationship table directly</strong>):</p>
<ul>
  <li><em>geodb_rel_origin_oid - </em>the ID attribute to be used from the related origin feature</li>
  <li><em>geodb_rel_destination_oid - </em>the ID attribute to be used from the related destination feature</li>
  <li><em>geodb_type - </em>either geodb_relationship or geodb_attributed_relationship</li>
</ul>
<p>The following attribute must be stored on features written to the origin and destination feature classes/tables which participate in the relationship (this applies to all types of cardinality (1:1, 1:M, M:N and attributed)):</p>
<ul>
  <li><em>geodb_oid - </em>the ID attributes which were used in the geodb_rel_origin_oid and the geodb_rel_destination_oid.</li>
  <li><em>geodb_feature_has_relationships - </em>Set to “YES” to specify that a feature participates in a relationship as an origin or destination.</li>
</ul>
<p><strong>Note:</strong></p>
<ul>
  <li>the _oid values mentioned above are not transferred to the Geodatabase. They are only supplied so that the Geodatabase writer knows which features are related.</li>
  <li>the _oid values must be <strong>integers</strong></li>
</ul>
<p>Required attributes for writing to relationship classes:</p>
<table class="featureTable sort_table">
  <tbody class="tbody">
    <tr>
      <td colspan="1" rowspan="1"><strong>Object</strong></td>
      <td colspan="1" rowspan="1"><strong>Required Attributes</strong></td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">Origin feature class or table</td>
      <td colspan="1" rowspan="1">geodb_oid<p>geodb_feature_has_relationships = <em>yes</em></p>
      </td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">Destination feature class or table</td>
      <td colspan="1" rowspan="1">geodb_oid<p>geodb_feature_has_relationships = <em>yes</em></p>
      </td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">Relationship class</td>
      <td colspan="1" rowspan="1">geodb_rel_origin_oid<p>geodb_rel_destination_oid</p>
        <p>geodb_type = <em>geodb_relationship</em> or <em>geodb_attributed_relationship</em></p>
        <p>Table Handling: <strong>Use Existing</strong></p>
      </td>
    </tr>
  </tbody>
</table>
<p>For example, if an origin feature has geodb_oid = 1 and a destination feature has geodb_oid = 2, the feature written to the relationship table must have these attributes:</p>
<p>geodb_rel_origin_oid = 1</p>
<p>geodb_rel_destination_oid = 2<br /> </p>
<h2 id="relationships-insert-update-or-delete">
  <span>Relationships: insert, update or delete</span>
</h2>
<p>Note that features participating in an <strong>attributed relationship</strong> can be inserted, updated and deleted. But features participating in a <strong>non-attributed relationship</strong> can only be inserted and deleted. Because attributed relationships have intermediate tables associated with them, the attributes of the intermediate table (excluding key values), may be updated by providing an RID (relationship id) as an update/key field.</p>
<p>Relationship Keys</p>
<p>In a geodatabase, the relationship keys do not have to be of type Object ID (integers). They could be a GUID for example. In this case, it's tempting to load the foreign key attributes in the relationship. You don't need to do this. You only need to set the values of geodb_rel_origin_oid &amp; geodb_rel_destination_oid. The FME Geodb writer will populate the relationship feature class foreign keys.</p>
<p><strong>Use only one Geodatabase writer:</strong> Be careful if you have more than one Geodatabase writer in your workspace. The origin and destination feature classes (or tables) that participate in the relationship and the relationship class must be written by the same Geodatabase writer (i.e. you cannot write to feature classes with one Geodatabase writer and to relationship classes with another).<br /> </p>
<h2 id="inserting-into-a-m-n-or-attributed-relationship-class-table">
  <span>Inserting into a M:N or attributed relationship class table</span>
</h2>
<p>Sometimes, the data in the origin and destination feature classes already exists and you just want to <strong>add the relationships </strong>to the relationship table. You can do this if:</p>
<p>- the relationship is M:N or an attributed relationship</p>
<p>- the relationship class already exists in your geodb</p>
<p>Set the geodb_type to geodb_relationship or geodb_attributed relationship (if attributed) and the geodb_rel_origin_oid and geodb_rel_destination_oid to their respective OBJECTID's. This does require that FME reads the feature classes which participate in the relationship but does not involve writing them out again. Only the relationship table needs to be written to in this case.</p>
<h2 id="relationships-background">
  <span>Relationships Background</span>
</h2>
<p>Relationships must be created using the ArcGIS tools, as they cannot be created in FME.</p>
<p> </p>
<p><strong>1:1, 1:M non-attributed relationships:</strong> These have no intermediate table for keeping track of relationships. They are linked using a primary (origin table) and foreign (destination table) key.<br /><br /><strong>M:N and any 1:1, 1:M or M:N attributed relationships:</strong> Separate tables are used to keep track of the relationships. In order to track these relationships, each relationship entry contains a unique RID value along with the primary and foreign key.<br /><br /><strong>File Geodatabase and SDE Geodatabase:<br />1:1, 1:M non-attributed feature classes:</strong> If inserting with FME you would either be starting with empty feature classes (because as soon as you create the relationship in ArcMap, the relationship is already completed), or you would be deleting and re-inserting features which participate in the relationship and thus rebuilding that relationship.</p>
<p> </p>
<p><strong>File Geodatabase ONLY - not SDE geodatabase:<br />1:1, 1:M, M:N attributed relationships and M:N non-attributed relationships:</strong> If you have populated feature classes and need to insert into the relationship table to populate it, or you want to update or insert attributes in an attributed relationship table, you may simply insert into the relationship table directly without writing to the feature classes which participate in the relationship. This includes the primary/foreign key and/or attributes. The assumption here is you already have a table or some source with those relationships defined. It's probably a less common workflow but it's doable and perhaps a good advanced post or just something we add to one of the articles as an aside. Generally, you will be inserting to both the feature classes and building/inserting into the relationship table at the same time.</p>
<p> </p>
<p><strong>SDE Geodatabase:</strong><br /><strong>1:1, 1:M, M:N attributed relationships and M:N non-attributed relationships:</strong></p>
<p>FME may only be used to UPDATE the attributes in an attributed relationship, not the RID, foreign and primary keys. If this is desirable, a DELETE and INSERT operation must be performed.</p>
<p>Currently, there isn’t a way to insert existing relationship attributes into a relationship table with a SDE Geodatabase without reading the features participating in the relationship in order to get the ObjectID. This is in part because populating these relationships in ArcGIS requires the origin and destinations to be picked interactively rather than just defining the relationship. As such, If the features which participate in the relationship classes already exist in the database and only the relation table needs to be populated, the features which participate must still be read. This is required in order to get the ObjectID’s, however these features do not be to be written back. The ObjectID's read from the origin and destination relationship features will need to be renamed to the geodb_rel_origin_oid and geodb_rel_destination_oid respectively in order for the relationship table to be populated.<br /> </p>
<h2 id="deleting-records-from-a-relationship-class">
  <span>Deleting Records from a Relationship Class</span>
</h2>
<p>A little more on deleting records for a relationship class...</p>
<p>You can delete individual records from a relationship class. To do this you can:</p>
<ul>
  <li>delete the features from the participating feature classes. This will depend on the relationship (1:M, N:M etc.) But if you delete the participating features then the associated relationship record should be removed. For example, for a 1:M you should only have to remove the origin (parent) feature.</li>
  <li>delete the relationship record directly. To do this you need to set both the geodb_rel_origin_oid and geodb_rel_destination_oid. These act like a unique key to the relation record. You do need to set a key field on the FME Geodb writer (i.e. RID), but this is ignored for relationship classes.</li>
</ul>