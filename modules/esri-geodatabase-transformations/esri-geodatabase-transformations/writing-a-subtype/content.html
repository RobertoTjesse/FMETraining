<h2 id="learning-objectives">
  <span>Learning Objectives</span>
</h2>
<p>After completing this unit, you’ll be able to:</p>
<ul>
  <li>Read subtype values.</li>
  <li>Write to an existing table containing an existing subtype.</li>
  <li>Know the limitations of setting subtypes.</li>
</ul>
<h2 id="resources">
  <span>Resources</span>
</h2>
<ul>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingASubtype.zip" rel="noreferrer noopener" target="_blank">WritingASubtype.zip</a></li>
</ul>
<h2 id="introduction">
  <span>Introduction</span>
</h2>
<p>A subtype defines aspects of a geodatabase schema that relates to data classification. In other words, instead of creating different feature classes for a set of features, a subtype functions as a way to define a subset of features within an individual geodatabase feature class. An attribute in the feature class stores integer values that define the subtype, and a subtype table contains definitions for the corresponding integer value. For instance, a table named “Road” may have an attribute field called "Condition", whose values map to a subtype containing values good, moderate, and bad.<br />In general, each table can have only one subtype, all codes must be unique and be valid integers, and all code:description pairs must be unique.<br />It should be noted that a subtype is specific to a particular feature class. Therefore, it cannot be shared by other feature classes in the geodatabase in the way that a domain can be shared.</p>
<h2 id="reading-subtypes">
  <span>Reading Subtypes</span>
</h2>
<p>When reading a Geodatabase, FME has an option to "Resolve Subtypes".<br /><img src="images/1638391154898.png" class="image image-block" alt="Resolve Subtypes" /><br /><br />When this option is checked, the format attribute geodb_subtype_name will be populated with the descriptive value contained in the subtype definition.<br /> </p>
<h2 id="writing-subtypes">
  <span>Writing Subtypes</span>
</h2>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://res.cloudinary.com/hy4kyit2a/image/upload/doc/trailhead/en-usb473bb5ea1b7e61dfb07e6a7e547de6b.gif" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p><strong>When Creating Subtypes we recommend using a Geodatabase Template as described in How to Use an Esri Template.</strong> This is generally easier and more flexible than defining subtypes within FME feature types.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<p><br />Due to the fact that a subtype can only apply to a single feature class, it is not possible to create a new table and associate it with an existing subtype. As such, when writing geodatabase subtypes, the workflow requirements will fall under the following scenario:</p>
<ul>
  <li>Write to an existing table containing an existing subtype.</li>
</ul>
<p>The above scenarios will be controlled primarily by the following parameters:</p>
<ul>
  <li>Validate Features to Write parameter: Yes / No </li>
</ul>
<h2 id="requirements">
  <span>Requirements</span>
</h2>
<p>The Esri Geodatabase (File Geodb) reader/writer used in the following example requires that a licensed version of ArcGIS be available to the user. For more information on required ArcGIS license levels, please see <a href="https://community.safe.com/s/article/required-arcgis-license-types-for-fme-geodatabase" rel="noreferrer noopener" target="_blank">Required ArcGIS License Types for FME Geodatabase Formats</a>.</p>
<h2 id="scenario-1-writing-to-an-existing-table-containing-an-existing-subtype">
  <span>Scenario 1: Writing to an existing table containing an existing subtype</span>
</h2>
<p>No additional work is required to write to an existing table with an existing subtype. It’s not even necessary to set the writer parameter “Validate Features to Write” in order to validate the subtype value. A feature with an undefined subtype value will be rejected anyway, with the following error:</p><pre>For the '&lt;ClassName&gt;' table/feature class the subtype code of '&lt;Value&gt;' is not valid for the subtype field '&lt;SubtypeName&gt;'</pre>
<p> </p>
<p><strong>Limitations</strong></p>
<p>At the time of writing, FME will not allow you to associate different domains based on a particular subtype. For instance, you would not be able to set range domains of 0-50,000; 50,000-100,000; 100,000-250,000 and apply them to a subtype definition containing the values of Small, Medium, and Large. In order to achieve this, you would need to create the domain:subtype relationship in ArcGIS.</p>
<h2 id="scenario-2-writing-to-a-new-table-and-creating-a-new-subtype-nbsp">
  <span>Scenario 2: Writing to a new table and creating a new subtype </span>
</h2>
<p><strong>Source Data</strong></p>
<p><a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingASubtype/Parks.zip" rel="noreferrer noopener" target="_blank">Parks (MapInfo TAB - MITAB)</a><br /><img src="images/1638391402221.png" class="image image-block" alt="Inspect source data in Visual Preview" /></p>
<h2 id="step-by-step-instructions">
  <span>Step-by-step Instructions</span>
</h2>
<p><strong>1. Read Source Data</strong><br />In FME Workbench, open a blank workspace. Add a MapInfo TAB (MITAB) reader to the canvas and browse to the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingASubtype/Parks.zip" rel="noreferrer noopener" target="_blank">Park.tab</a> dataset, which can be downloaded from the Resources section of this article. Then click OK to add the reader. The data in this file will be used to calculate Park area values that will be subject to the subtype definition in the destination geodatabase.</p>
<p><img src="images/1638391574676.png" class="image image-block" alt="Add reader" /><br /><br /><strong>2. Calculate Area</strong><br />Next, we will calculate the area of each park polygon. Add an AreaCalculator to the canvas and connect it to the Parks reader feature type. We can accept the default parameters. The value for the calculated area will be stored in an attribute named <strong>_area</strong>.<br /><br /><strong>3. Map Calculated Values to Subtype Codes</strong><br />The AttributeRangeMapper will be used to map values coming from the _area attribute (created to the subtype codes we will apply to the subtype definition. The code applied will be based on whether the initial values fall into a specified range. Add an AttributeValueMapper to the canvas and connect it to the AreaCalcultor. Open the parameters, set the <em>Source Attribute</em> to <strong>_area</strong>, then change the <em>Output Attribute</em> to <strong>ParkSize</strong>.  For the <em>Range Lookup Table</em>, enter the following values:</p>
<table class="featureTable sort_table">
  <thead class="thead sorted">
    <tr>
      <th colspan="1" rowspan="1" scope="col">From</th>
      <th colspan="1" rowspan="1" scope="col">To</th>
      <th colspan="1" rowspan="1" scope="col">Output Value</th>
    </tr>
  </thead>
  <tbody class="tbody">
    <tr>
      <td colspan="1" rowspan="1"> </td>
      <td colspan="1" rowspan="1">10000</td>
      <td colspan="1" rowspan="1">1</td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">10000</td>
      <td colspan="1" rowspan="1">1000000</td>
      <td colspan="1" rowspan="1">2</td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">1000000</td>
      <td colspan="1" rowspan="1"> </td>
      <td colspan="1" rowspan="1">3</td>
    </tr>
  </tbody>
</table>
<p><img src="images/1638391601775.png" class="image image-block" alt="AttributeRangeMapper" /><br /><br /><strong>4. Write Features &amp; Writer to Subtype Field</strong><br />Add an Esri Geodatabase (File Geodb) writer to the canvas and browse to a location to save the output geodatabase. Set the Feature Class or Table Definition to Import from Dataset, then open the Parameters.<br /><img src="images/1638391692407.png" class="image image-block" alt="Import from Dataset" /><br /><br />In the Parameters, enable Overwrite Existing Geodatabase, and then set the Template File Geodatabase to <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingASubtype/Subtypes.gdb.zip" rel="noreferrer noopener" target="_blank">Subtypes.gdb</a>. Click <strong>OK</strong> twice to finish adding the writer.<br /><img src="images/1638391793435.png" class="image image-block" alt="enable Overwrite Existing Geodatabase, and then set the Template File Geodatabase to Subtypes.gdb" /><br /><br />In the Import Writer Feature Types dialog, navigate to the template geodatabase (Subtypes.gdb) then click <strong>OK</strong>.<br /><img src="images/1638392035893.png" class="image image-block" alt="Import writer feature types" /><br /><br />Since there is only one feature class in the template geodatabase, it will get added automatically. Connect the Parks writer feature type to the AttributeRangeMapper.<br /><br /><strong>5. Define Table Handling to Update </strong><br />Now we need to define how the table will be handled, since we already have 80 features with the subtypes attached and we are only adding attributes, we will need to update the incoming features instead of creating new ones. Open the Parks writer feature type parameters. In the General section, change the Feature Operation to Update, the Table Handling to Use Existing, and the Match Columns to ParkID, then click OK.</p>
<p><img src="images/1638392236647.png" class="image image-block" alt="change the Feature Operation to Update" /><br /><br /><strong>6. Save and Run the Workspace</strong><br />Save and run the workspace. View the output geodatabase in ArcMap to confirm the subtypes were mapped correctly.<br /><img src="images/1638392350271.png" class="image image-block" alt="View the output geodatabase in ArcMap" /><br /><img src="images/1638392413357.png" class="image image-block" alt="Inspect subtypes in ArcMap" /></p>