<h2 id="learning-objectives">
  <span>Learning Objectives</span>
</h2>
<p>After completing this unit, you’ll be able to:</p>
<ul>
  <li>Write feature-linked annotation.</li>
  <li>Know the limitations of writing feature-linked annotation.</li>
  <li>Know how to preserve edited annotations.</li>
</ul>
<h2 id="resources">
  <span>Resources</span>
</h2>
<ul>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/Feature_Linked_Annotation.zip" rel="noreferrer noopener" target="_blank">Feature_Linked_Annotation.zip</a></li>
</ul>
<h2 id="introduction">
  <span>Introduction</span>
</h2>
<p>Although annotations are stored in a separate feature layer in a geodatabase, they can be linked to other features through feature-linked annotations. Feature-linking occurs when there is a relationship between an annotation feature class and some other feature class.<br />Linking is carried out by defining a relationship through a common attribute. The relationship must already be defined in the geodatabase before writing the data.<br />How it works in FME: If the relationship for the annotation exists in the geodatabase, then FME will automatically create the annotation and the relationship. The FME geodatabase writer will retrieve the object ID of the new feature and then write the annotation feature and the relationship linking to it. The result is that you only need to write to the primary feature class (Zones in the example below) and the one FME feature contains enough information to write two features: one annotation feature (ZoneNames) and one primary feature (Zones). The annotation created is based on the annotation rules you've created in your target geodatabase in the annotation feature class (ZoneNames)</p>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://res.cloudinary.com/hy4kyit2a/image/upload/doc/trailhead/en-usb473bb5ea1b7e61dfb07e6a7e547de6b.gif" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p><br />This tutorial walks through the process of writing the original ArcGIS Desktop(ArcMap) Annotation.<br /> </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<h2 id="requirements">
  <span>Requirements</span>
</h2>
<p>The Esri Geodatabase (File Geodb) reader/writer used in the following example requires that a licensed version of ArcGIS be available to the user. For more information on required ArcGIS license levels, please see <a href="https://community.safe.com/s/article/required-arcgis-license-types-for-fme-geodatabase" rel="noreferrer noopener" target="_blank">Required ArcGIS License Types for FME Geodatabase Formats</a>.<br /> </p>
<h2 id="video">
  <span>Video</span>
</h2>
<p><iframe width="640" src="https://play.vidyard.com/YkZZxmUaY2aWoPrfVj4Cg8.html?" height="360" title="Video Content"></iframe><br title="Video Content" /> </p>
<h2 id="source-data">
  <span>Source Data</span>
</h2>
<p><a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/Feature_Linked_Annotation/Zones.zip" rel="noreferrer noopener" target="_blank">Zones (MapInfo TAB)</a></p>
<p><img src="images/1638396107583.png" class="image image-block" alt="Inspect Zones in Visual Preview" /></p>
<p>In the above image, we see a visualization of the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/Feature_Linked_Annotation/Zones.zip" rel="noreferrer noopener" target="_blank">Zones TAB</a> file and its accompanying attributes. The ZoneName attribute will provide the values for the feature-linked annotation.<br /> </p>
<h2 id="step-by-step-instructions">
  <span>Step-by-step Instructions</span>
</h2>
<p><strong>1. Set Up Destination Geodatabase</strong><br />As mentioned above, feature-linking is carried out by defining a relationship through a common attribute. As such, it is necessary to determine the relationship between your features and annotations in a destination geodatabase prior to writing the data. This process would entail using ArcGIS to create an empty feature class to hold the Zone features, an empty feature-linked annotation class (designed with the required scale, placement properties, text size, etc) to hold the Zone annotations, and a relationship class to link the two together </p>
<p><img src="images/1639495623688.png" class="image image-block" alt="Feature_Linked in ArcCatalog" /><br /></p>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://res.cloudinary.com/hy4kyit2a/image/upload/doc/trailhead/en-usb473bb5ea1b7e61dfb07e6a7e547de6b.gif" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p>Generating a feature linked annotation class in ArcGIS should create the necessary relationship class).</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<p><br />For purposes here, a geodatabase template file has already been created, and is available from the Resources section on this article. The template file in this example is called `<a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/Feature_Linked_Annotation/DESTINATION_GDB_TEMPLATE.XML" rel="noreferrer noopener" target="_blank">DESTINATION_GDB_TEMPLATE.XML</a>` and will be used during the translation to apply the required schema to our destination geodatabase.<br /><br /><strong>2. Read Source Data - MapInfo TAB (MITAB)</strong><br />Zoning feature geometry and annotations are read from the TAB source file using the MapInfo TAB (MITAB) reader, providing the features and annotations for the destination feature classes (Zones and ZoneNames) in the Geodatabase referenced in Step 1. The annotation values will be provided from the ZoneName attribute in the source data.<br />Open a blank workspace in FME Workbench and add a MapInfo TAB (MITAB) reader to the canvas. Browse to the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/Feature_Linked_Annotation/Zones.zip" rel="noreferrer noopener" target="_blank">Zones.tab</a> dataset, then click OK to add the reader.<br /><img src="images/1638396144237.png" class="image image-block" alt="Add Reader" /><br /><br /><strong>3. Write Geodatabase Features and Feature-Linked Annotation</strong><br />Now we can write the data out. Add an Esri Geodatabase (File Geodb) writer to the canvas. Browse to a location to save the geodatabase and call it <strong>feature_linked_anno.gdb</strong>, then open the Parameters.<br /><br /><img src="images/1638396506675.png" class="image image-block" alt="Add writer" /><br /><br />As mentioned above, rather than create the geodatabase from scratch, we’ll use an ArcGIS XML Workspace Document. This template was created by exporting it from an existing geodatabase. In this case, the template file was exported from a geodatabase containing a feature class, feature-linked annotation class, and relationship class.<br />In the Parameters, set the Import XML Workspace Document (Schema Only) to <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/Feature_Linked_Annotation/DESTINATION_GDB_TEMPLATE.XML" rel="noreferrer noopener" target="_blank">DESTINATION_GDB_TEMPLATE.XML</a> which is available from the Resources section. Next, set the <em>Transaction Type</em> to <strong>Edit Session</strong>. We are dealing with complex features that can only be edited in an Edit Session or Version. Then click <strong>OK</strong> twice to add the writer.<br /><img src="images/1638726633674.png" class="image image-block" alt="set the Import XML Workspace Document (Schema Only) to DESTINATION_GDB_TEMPLATE.XML" /><br /><br />Once the writer has been added to the canvas, connect it to the Zones reader feature type, then double-click on it to open the parameters. Set the <em>Geometry</em> to <strong>geodb_annotation</strong>, then click <strong>OK</strong>.<br /><img src="images/1638726676152.png" class="image image-block" alt="Set the Geometry to geodb_annotation" /><br /><br /><strong>4. Save and Run Workspace</strong><br />Now you can go ahead and save the workspace before running it. View the output in ArcMap.<br /><img src="images/1638726752391.png" class="image image-block" alt="View the output in ArcMap" /></p>
<h2 id="adding-the-writer-if-you-are-not-using-a-template-file">
  <span>Adding the Writer If You Are NOT Using A Template File:</span>
</h2>
<p>If a template file is not available and a destination geodatabase was created from scratch as mentioned in Step 1, when adding the Esri Geodatabase (File Geodb) writer, be sure to set the Add Feature Type(s) section of the writer dialog to "Import from Dataset". In the Parameters set the <em>Transaction Type</em> to <strong>Edit Session</strong>, then click <strong>OK</strong> twice.<br /><img src="images/1638726843734.png" class="image image-block" alt="Import from Dataset" /><br /><br />When prompted, set the format and select the geodatabase created in Step 1 and click <strong>OK</strong>. FME will scan the geodatabase to confirm what tables exist. When prompted with a list of classes, select only the feature class that you wish to populate with features.<br /><br />Once the writer is added, connect the output of the MapInfoTAB reader to the geodatabase writer. </p>
<h2 id="geodatabase-to-geodatabase">
  <span>Geodatabase to Geodatabase</span>
</h2>
<p>When converting one geodatabase to another, it is also possible to create new feature-linked annotations in the same way as described above. However, in some cases, you may have edited your annotations and you want to preserve those edits. To do this you need to link the source annotations back to the primary feature and set the geodb_&lt;anno&gt; format attributes for the annotation characteristics you want to preserve. Also, in your target geodatabase template, ensure that the annotation does not automatically create on feature insert. To do this you need to edit the ArcGIS annotation properties and uncheck "Create annotation when features are added". Then export that to your Esri XML Workspace Document that you'll use for your geodatabase template.<br /><img src="images/1638726889040.png" class="image image-block" alt="uncheck &quot;Create annotation when features are added&quot;" /><br /><br />In this example, the source geodatabase has the feature class Zones and feature-linked annotation ZoneNames. </p>