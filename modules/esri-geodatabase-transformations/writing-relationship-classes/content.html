<h2 id="learning-objectives">
  <span>Learning Objectives</span>
</h2>
<p>After completing this unit, you’ll be able to:</p>
<ul>
  <li>Author a 1:M relationship class translation in FME.</li>
  <li>Insert data into a M:N or Attributed Relationship.</li>
  <li>Know the FME format attributes requires to write to Relationship Classes.</li>
</ul>
<h2 id="resources">
  <span>Resources</span>
</h2>
<ul>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingRelationshipClasses.zip" rel="noreferrer noopener" target="_blank">WritingRelationshipClasses.zip</a></li>
</ul>
<h2 id="introduction">
  <span>Introduction</span>
</h2>
<p>This article contains a number of writing geodatabase relationship classes examples. It includes demos for concepts covered in <a href="https://safe.my.trailhead.com/en/content/safe/modules/esri-geodatabase-transformations/working-with-relationship-classes" rel="noreferrer noopener" target="_blank">Working with Geodatabase Relationship Classes</a>. Examples cover 1:M Relationship, Inserting into a M:N M:N or Attributed Relationship, and Advanced M:N Relationship.</p>
<p>For the following examples, it is assumed that the relationships have already been created in ArcGIS. This is required, as FME cannot create the relationships, but merely populate them.</p>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://res.cloudinary.com/hy4kyit2a/image/upload/doc/trailhead/en-usb473bb5ea1b7e61dfb07e6a7e547de6b.gif" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p><br /><em>FME cannot create the relationship class in the target geodatabase. Either create the relationship class in ArcGIS/ArcPro, or use a </em><strong><em><a href="https://safe.my.trailhead.com/en/content/safe/modules/esri-geodatabase-transformations/how-to-use-an-esri-template" rel="noreferrer noopener" target="_blank">template</a>.</em></strong></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<h2 id="requirements">
  <span>Requirements</span>
</h2>
<p>The Esri Geodatabase (File Geodb) reader/writer used in the following example requires that a licensed version of ArcGIS be available to the user. For more information on required ArcGIS license levels, please see <a href="https://community.safe.com/s/article/required-arcgis-license-types-for-fme-geodatabase" rel="noreferrer noopener" target="_blank">Required ArcGIS License Types for FME Geodatabase Formats</a>. </p>
<h2 id="video">
  <span>Video</span>
</h2>
<p><iframe width="640" src="https://play.vidyard.com/ogy4qttqrMa8Es7Tfx6VER.html?" height="360"></iframe></p>
<h2 id="1-m-relationship-example">
  <span>1:M Relationship Example</span>
</h2>
<p>In this example, a 1:M relationship class translation will be demonstrated. As mentioned in the previous article, when dealing with a relationship class that is centered around a 1:M category, there is no intermediate table to keep track of these relationships. As such the relationships are bound to each other through the Primary and Foreign Keys. </p>
<h2 id="step-by-step-instructions">
  <span>Step-by-Step Instructions</span>
</h2>
<p><strong>1. Open FME Workbench</strong><br />Open FME Workbench and start a blank workspace. Add an Esri Geodatabase (File Geodb) reader to the canvas and browse to the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingRelationshipClasses/1ManyRelationshipStart.gdb.zip" rel="noreferrer noopener" target="_blank">1ManyRelationshipStart.gdb</a>. There are no additional parameters to set for this reader, so click OK.<br /><img src="images/1638849414946.png" class="image image-block" alt="Add Reader" /><br /><br />In the <em>Select Feature Types</em> dialog, select both feature classes (<strong>A_A_Parcels</strong> and <strong>A_Neighborhoods</strong>) and click <strong>OK</strong>.<br /><br /><strong>2. Create geodb_feature_has_relationships Attribute</strong><br />Add an AttributeCreator to the canvas and connect it to the A_A_Parcels reader feature type. In the parameters, create a new attribute called <strong>geodb_feature_has_relationships</strong> with the value to <strong>yes</strong>. Next, create another attribute called <strong>geodb_oid</strong> and set it to the attribute <strong>OBJECTID</strong>, then click <strong>OK</strong>.<br /><img src="images/1638849434605.png" class="image image-block" alt="create another attribute called geodb_oid and set it to the attribute OBJECTID" /><br /><br />Duplicate the AttributeCreator (ctrl-d or <strong>⌘</strong>-d) and connect it to the A_Neighborhoods reader feature type.<br /><img src="images/1638849471065.png" class="image image-block" alt="Workspace so far" /><br /><br /><strong>3. Write to Geodatabase</strong><br />Add an Esri File Geodatabase (File Geodb) writer to the canvas and select a folder to save the output to. For this example, we named the geodatabase <strong>1_to_many.gdb</strong>. Set the <em>Feature Class or Table Definition</em> to <strong>Import from Dataset</strong>, then open the Parameters.<br /><img src="images/1638849526022.png" class="image image-block" alt="Add writer" /><br />In the Parameters, enable <strong>Overwrite Existing Geodatabase</strong>, then for <em>Import XML Workspace Document (Schema Only)</em> browse to the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingRelationshipClasses/XMLWORKSPACETEMPLATE.XML" rel="noreferrer noopener" target="_blank">XMLWORKSPACETEMPLATE.XML</a>. Click <strong>OK</strong> twice to add the writer.<br /><img src="images/1638849553337.png" class="image image-block" alt=" Import XML Workspace Document" /><br />Now in the <em>Import Writer Feature Types </em>dialog, change the format to <strong>Esri Geodatabase (XML Workspace Document)</strong> then browse to the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingRelationshipClasses/XMLWORKSPACETEMPLATE.XML" rel="noreferrer noopener" target="_blank">XMLWORKSPAPCETEMPLATE.XML</a>.<br /><img src="images/1638849579233.png" class="image image-block" alt="import writer feature types" /><br />In the <em>Select Feature Types</em> dialog, select both the feature types and click <strong>OK</strong>.<br /><br />Connect the writer feature types to their corresponding AttributeCreators.<br /><br /><strong>4. Save and Run the Workspace. </strong><br />Save the workspace, then run it. Open the geodatabase in ArcCatalog, you should be able to see which features are related. Here is an example for ParcelID: 144. It can be seen, as being related to the Kitsilano Neighborhood.<br /><img src="images/1638849625063.png" class="image image-block" alt="Inspect in ArcMap" /> </p>
<h2 id="inserting-into-a-m-n-or-attributed-relationship-example">
  <span>Inserting into a M:N or Attributed Relationship Example</span>
</h2>
<p>Sometimes, the data in the origin and destination feature classes already exists and you just want to add the relationships to the relationship table. You can do this if:</p>
<ul>
  <li>The relationship is M:N or an attributed relationship</li>
  <li>The relationship class already exists in your geodatabase</li>
</ul>
<p>To add the relationships, set the geodb_type to geodb_relationship or geodb_attributed relationship (if attributed) and the geodb_rel_origin_oid and geodb_rel_destination_oid to their respective OBJECTID's. This does require that FME reads the feature classes which participate in the relationship but does not involve writing them out again. Only the relationship table needs to be written to in this case. </p>
<h2 id="step-by-step-instructions-m-n">
  <span>Step-by-Step Instructions - M:N</span>
</h2>
<p><strong>1. Review Geodatabase in ArcGIS</strong><br />Before we create the relationship in FME, let’s review the structure of the data in ArcCatalog. Open Esri ArcCatalog, and navigate to the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingRelationshipClasses/Many2ManyInput.gdb.zip" rel="noreferrer noopener" target="_blank">Many2ManyInput.gdb</a> file contained with the Resources zip file. This will be the same geodatabase that we will use in FME.<br /><br />From looking at the geodatabase we can see two tables (Structure and ADDRESS) as well as a relationship class(Structure_to_Address_rel).<br /><img src="images/1638849698158.png" class="image image-block" alt="looking at the geodatabase we can see two tables" /><br />Here you can see that the relationship class has already been created. The view can be accessed through ArcGIS, and opening the properties of the relationship class. Right-click relationship class &gt; Properties. As a reminder, this is because relationship classes must be created in ArcGIS and then they can be populated through FME.<br /><img src="images/1638849732778.png" class="image image-block" alt="Inspect relationship class properties in ArcMap" /><br /><strong>2. Add Geodatabase to FME Workbench</strong><br />Now that we’ve inspected our geodatabase in ArcGIS and know the relationship we are working with, we can move to FME Workbench. Open a blank workspace in FME Workbench. Add an <strong>Esri Geodatabase (File Geodb)</strong> reader to the canvas and browse to the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingRelationshipClasses/Many2ManyInput.gdb.zip" rel="noreferrer noopener" target="_blank">Many2ManyInput.gdb</a> dataset, then click <strong>OK</strong>.<br /><img src="images/1638849769899.png" class="image image-block" alt="Add reader" /><br />In the <em>Select Feature Types</em> dialog, select only <strong>ADDRESS</strong> and <strong>Structure</strong>, then click <strong>OK</strong>.</p>
<p><img src="images/1638849788691.png" class="image image-block" alt="Select feature types" /><br /><strong>3. Modify Attributes to Reflect Relationship Class</strong><br /> With the fact, this is a M:N relationship we need to ensure a few attributes are stored on features to be written to the relationship class.</p>
<ul>
  <li>geodb_rel_origin_oid - the ID attribute to be used from the related origin feature.</li>
  <li>geodb_rel_destination_oid - the ID attribute to be used from the related destination feature.</li>
  <li>geodb_type - either geodb_relationship or geodb_attributed_relationship</li>
</ul>
<p>The Origin and Destination oid, refer to the primary and foreign keys on the respective feature classes. In this example, we used the ObjectID as the value for the newly created origin/destination oid. </p>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://res.cloudinary.com/hy4kyit2a/image/upload/doc/trailhead/en-usb473bb5ea1b7e61dfb07e6a7e547de6b.gif" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p>These newly created values, are not explicitly written to the geodatabase, but rather help FME process how the features are related to the relationship. In order to store these features to each feature class, we need to add an AttributeCreator per feature class.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<p>Add an AttributeCreator to the canvas and connect it to the ADDRESS reader feature type. In the parameters, create a new attribute called geodb_rel_destination_oid with the Value of OBJECTID.<br />Add another AttributeCreator to the canvas and connect it to the Structure reader feature type. In the parameters, create a new attribute called geodb_rel_origin_oid with the Value of OBJECTID.<br /><br /><strong>4. Merge Features</strong><br />With the Primary and Foreign keys set, we can now merge the features using the FeatureJoiner. This will merge the features using the field that is shared between the two feature classes, in this case, Structure.SiteID and Address.Remarks.<br />Add a FeatureJoiner to the canvas and connect the ADDRESS AttributeCreator to the Left input port, and the Structure AttributeCreator_2 to the Right input port. In the parameters, set the <em>Join On Left</em> to <strong>REMARKS</strong> and the <em>Right</em> to <strong>SITEID</strong>, then click <strong>OK</strong>.<br /><br /><strong>5. Set Feature Class</strong><br />Lastly, another AttributeCreator transformer is required to ensure that the features are recognized as a feature class. This is done by setting the geodb_type as ‘geodb_relationship’, if you were dealing with an attributed relationship, the value would need to be set to ‘geodb_attributed_relationship’.<br />Add an AttributeCreator to the canvas and connect it to the Joined output port on the FeatureJoiner. In the parameters, create a new attribute called geodb_type and set the Value to geodb_relationship, then click OK.<br /><br /><strong>6. Write out to File Geodatabase</strong><br />Finally, we can write out to a geodatabase. Add an <strong>Esri Geodatabase (File Geodb)</strong> writer to the canvas and browse to a location to save the geodatabase. Change the <em>Feature Class or Table Definition</em> to <strong>Import from Database</strong> and then open the Parameters.</p>
<p><img src="images/1638849884007.png" class="image image-block" alt="Add writer" /><br />In the Parameters, enable <strong>Overwrite Existing Geodatabase</strong> and then for <em>Template File Geodatabase</em> browse to the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingRelationshipClasses/Many2ManyInput.gdb.zip" rel="noreferrer noopener" target="_blank">Many2ManyTemplate.gbd</a> dataset. Click <strong>OK</strong> twice to add the writer.<br /><img src="images/1638849943436.png" class="image image-block" alt="enable Overwrite Existing Geodatabase" /><br />In the <em>Import Writer Feature Types</em> dialog, browse to the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingRelationshipClasses/Many2ManyInput.gdb.zip" rel="noreferrer noopener" target="_blank">Many2ManyTemplate.gdb</a>, then click <strong>OK</strong>.<br /><img src="images/1638849970524.png" class="image image-block" alt="import writer feature types" /><br />Then in the <em>Select Feature Types</em> dialog, only select <strong>Structure_to_Address_rel</strong>, and click <strong>OK</strong>.<br /><img src="images/1638849996073.png" class="image image-block" alt=" only select Structure_to_Address_rel" /><br />Once the Structure_to_Address_rel writer feature type has been added, connect it to the AttributeCreator_3.<br />At this stage of the workspace, we are writing directly to the relationship table. In order to do this correctly, the values we set earlier are required:</p>
<ul>
  <li>geodb_rel_origin_oid</li>
  <li>geodb_rel_destination_oid</li>
  <li>geodb_type</li>
</ul>
<p>We do not have to set the Foreign Key values (StructureEventID and AddressEventID) because these will be populated by the writer as long as the above values have been mapped accordingly.<br /><br /><strong>7. Save and Run the Workspace</strong><br />Save and then run the workspace. The Relationship class should now be populated with the Foreign key values for AddressEventID and StructureEventId. View your output in ArcGIS.<br /><img src="images/1638850033561.png" class="image image-block" alt="View your output in ArcGIS" /> </p>
<h2 id="advanced-m-n-relationship-example">
  <span>Advanced M:N Relationship Example</span>
</h2>
<p>In the M:N example above, the data already existed and we were just populating the relationship table to create the relation between the addresses and structures.<br />If you are inserting the data into a new geodatabase with a relationship class, a combination of the 1:M relationship workspace and updating a M:N relationship workspace are required to carry this task out. Again, it should be noted that the relationship class needs to be created in the destination geodatabase (or geodatabase template) prior to translation, via ArcGIS. An example of such a workspace can be seen in the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Resources/EsriGeodatabaseTransformations/WritingRelationshipClasses/Many_To_ManyAdvanced.fmwt" rel="noreferrer noopener" target="_blank">Many2ManyAdvanced</a> template (see the Resources section above)<br /><img src="images/1638850073108.png" class="image image-block" alt="the ‘Many2ManyAdvanced’ template" /></p>
<h2 id="nbsp">
  <span><br /> </span>
</h2>