<table class="featureTable sort_table">
  <tbody class="tbody">
    <tr>
      <td>Looping in a Custom Transformer</td>
    </tr>
    <tr>
      <td>Data</td>
      <td>Tree List</td>
    </tr>
    <tr>
      <td>Overall Goal</td>
      <td>Examine a custom transformer that breaks a list into pieces</td>
    </tr>
    <tr>
      <td>Demonstrates</td>
      <td>Custom Transformers and Loops</td>
    </tr>
    <tr>
      <td>Start Workspace</td>
      <td>None</td>
    </tr>
    <tr>
      <td>End Workspace</td>
      <td>C:\FMEData2019\Workspaces\DesktopAdvanced\CustomTransformers-Ex6-Complete.fmw</td>
    </tr>
  </tbody>
</table>
<p>In this exercise, we'll examine a custom transformer that includes a loop inside it, to see how it works.</p>
<hr />
<p><br /><strong>1) Open and Run Workspace</strong><br />Start FME Workbench and open the workspace CustomTransformers-Ex6-Complete.fmw.</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.249.Ex6.InitialWorkspace.png" alt class="image image-block image-center" /></p>
<p>The workspace generates a set of test data and then processes it with a custom transformer called the ListBreaker. Run the workspace, being sure to use Run &gt; Rerun Entire Workspace from either the menubar or toolbar.</p>
<p>Inspect the output of the test data bookmark, and the ListBreaker transformer. Notice that the test data starts out with a list of tree types and species:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.250.Ex6.InitialData.png" alt class="image image-block image-center" /></p>
<p>After processing, the list has been broken down into a set of attributes instead:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.251.Ex6.FinalResults.png" alt class="image image-block image-center" /></p>
<p>So now we know what the custom transformer does, let's see how it works...</p>
<p><br /><strong>2) Examine Custom Transformer</strong><br />Click on the ListBreaker tab (or right-click on the ListBreaker transformer and choose the option to Edit). The custom transformer definition looks like this:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.252.Ex6.CustomTransformer.png" alt class="image image-block image-center" /></p>
<p>We know the input of the transformer is a list. The transformer processes each element of that list, one at a time, looping around to fetch the next element once the previous one is processed.</p>
<p>Given that, there are various components that we can associate with different parts of a loop:</p>
<ol>
  <li>The input port where the feature with list attribute originally arrives.</li>
  <li>The loop setup. Makes a count of the number of list elements (y) and creates a loop counter (x) attribute.</li>
  <li>Carries out the actual processing. The ListIndexer fetches the xthÂ element in the list.</li>
  <li>The actual loop part. Increments the loop counter and checks if it is now the same as the number of elements (x=y).</li>
  <li>The end loop component that returns to the start-of-loop component.</li>
  <li>The start-of-loop component. Notice it is not published so it won't appear on the custom transformer on the canvas.</li>
  <li>This section is an error trap, to catch features with an empty list.</li>
</ol>
<p>Notice the feature counts for each connection. Notice how The transformer counts beyond the actual number of features by counting each pass for each loop. Here a single feature enters the transformer, and is twice passed back through the loop:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.253.Ex6.FeatureCounts.png" alt class="image image-block image-center" /></p>
<p>If three identical features entered the transformer, then the counts would be increased accordingly:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.254.Ex6.FeatureCounts-2.png" alt class="image image-block image-center" /></p>
<p><br /><strong>3) Inspect ListIndex Transformer</strong><br />Inspect the feature caches for the custom transformer. If, for example, you inspect the ListIndexer caches, notice how it's a little different to a standard cache. That's because we are inspecting the same feature within different loops (the loop counter attribute will show this):</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.255.Ex6.DataInspection.png" alt class="image image-block image-center" /></p>
<p>Inspect the parameters of the ListIndexer transformer:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.256.Ex6.ListIndexer.png" alt class="image image-block image-center" /></p>
<p>Notice how it is using the loop count attribute both for the list element to fetch and for the name of the attribute into which it is fetched. This is one of the unique capabilities of a looping transformer that make it so special.</p>
<p><br /><strong>4) Experiment with Input</strong><br />If time permits, experiment with the input to the transformer. You can do this by editing the contents of the Generate Test Data bookmark:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.257.Ex6.TestDataSetup.png" alt class="image image-block image-center" /></p>
<p>To increase the number of features, edit the Number to Create parameter of the Creator transformer (note the Aggregator is set up to Group-By the Creator ID number in order to keep the features separate).</p>
<p>To adjust the list contents, change the values in the AttributeCreator transformers. To create more list elements, add extra AttributeCreator transformers (this is not necessarily the best way to handle data, but it is fine for this limited test scenario).</p>
<hr />
<table class="featureTable sort_table">
  <tbody class="tbody">
    <tr>
      <td>CONGRATULATIONS</td>
    </tr>
    <tr>
      <td>By completing this exercise you have learned how to:<ul>
          <li>Set up a loop and initialize a loop counter</li>
          <li>Increment a loop counter</li>
          <li>Set up and test a loop condition</li>
          <li>Create a loop object in a custom transformer</li>
          <li>Analyze the feature counts inside a loop</li>
          <li>Use a loop counter attribute as a value in transformers inside the loop</li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>